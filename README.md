# Email Marketing Platform Monorepo

This repository houses the Vue 3 frontend and Flask 3 backend that power the enterprise email marketing platform described in `docs/product_strategy.md`.

## Structure

| Path | Description |
| --- | --- |
| `frontend/` | Vue 3 + Vite + TypeScript SPA with Pinia, Vue Router, Vue Query, Vitest, Cypress. |
| `backend/` | Flask application factory with SQLAlchemy, Celery tasks, IAM scaffolding, and pytest test suite. |
| `docs/` | Product strategy, IAM reference (`docs/iam_architecture.md`), and planning artifacts. |

## Quick Start

```bash
# Frontend
cd frontend
npm install
npm run dev

# Backend
cd backend
python -m venv .venv && source .venv/bin/activate
pip install -e .[dev]
flask seed-iam  # create default permissions/roles
flask --app email_marketing_backend.app run --debug
```

**Auth flow**

- `POST /api/auth/register` – create a workspace user (returns token & roles).
- `POST /api/auth/login` – authenticate existing users (requires password).
- `GET /api/auth/me` – fetch profile using `Authorization: Bearer <token>`.

Use an email ending with `@admin.com` to auto-provision the `org-admin` role in dev.

Legacy service-to-service calls can still include `X-API-Key: dev-internal-key` (override via `backend/.env`). The frontend handles registration/login for you.

**Working MVP flows**

- **Contacts**: `/app/contacts` (adds workspace contacts).
- **Template Studio**: `/app/templates` (GrapesJS drag/drop, save templates, send test emails).
- **Campaigns**: `/app/campaigns` (create campaign from template, send to all contacts or a custom email list; uses Celery worker).

Orchestrate everything (backend API, worker, Postgres, Redis, MinIO, Mailhog, and the Vite dev server) via Docker Compose:

```bash
docker compose up --build
```

## UAT / Prod

- UAT (nginx + production build): `docker compose -f docker-compose.uat.yml up --build`
- Prod (nginx + production build): `docker compose -f docker-compose.prod.yml up --build`

In UAT/Prod the SPA is served by nginx on `http://localhost:8081` (UAT) or `http://localhost:8080` (Prod) and nginx proxies `/api/*` to the backend.

## Tooling

- **Linting / Formatting** – Pre-commit hooks (Ruff, Black, isort, ESLint, Prettier) configured via `.pre-commit-config.yaml`.
- **CI** – GitHub Actions workflow runs JS/TS and Python unit tests plus lint.
- **Testing** – Vitest + Vue Testing Library, Cypress smoke E2E, Pytest with coverage (API + Celery tasks).

See `backend/README.md` and `frontend/README.md` (generated by Vite) for service-specific instructions.
